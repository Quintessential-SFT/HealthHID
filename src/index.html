<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#fafafa">
        <title>Designated HID Test Site</title>
        <script>
          let device = undefined;

          const getInputData = () => document.getElementById("input").value;
          const setOutputData = (data) => document.getElementById("output").value = data;

          const onDevice = (dev) => {
            device = dev;
            dev.strOut = (data) => setOutputData(data);
          };

          const getId = async () => {
            await window.HealthHid.MicrolifeBPM.getUserId(device);
          };
          // const setId = async () => {
          //   const id = getInputData();
          //   await window.HealthHid.MicrolifeBPM.setUserId(device, id);
          // };
          const getData = async () => {
            await window.HealthHid.MicrolifeBPM.getData(device);
          };
          const getUserSlotInfo = async () => {
            await window.HealthHid.MicrolifeBPM.getUserSlotInfo(device);
          };
        </script>
    </head>
    <body>
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h2>Designated HID Test Site</h2>
        <div>
            <button onclick="window.HealthHid.Device.requestDevice().then(dev => onDevice(dev));">
                Select Device
            </button>
            <button onclick="device.closeDevice().then(() => device = undefined);">
                Close Device
            </button>
        </div>
        </div>
        <hr />
        <div style="display: flex; flex-direction: column; margin-bottom: 0.5rem;">
            <div>Input:</div>
            <textarea id="input" style="resize: none; height: 50px"></textarea>
        </div>
        <div style="margin-bottom: 0.5rem;">
            <button onclick="getId()">
                Get ID
            </button>
<!--            <button onclick="setId()">-->
<!--                Set ID-->
<!--            </button>-->
            <button onclick="getData()">
                Get Data
            </button>
            <button onclick="getUserSlotInfo()">
                Get User Slot Info
            </button>
        </div>
        <div style="display: flex; flex-direction: column;">
            <div>Output:</div>
            <textarea id="output" disabled style="resize: none; height: 150px"></textarea>
        </div>

        <script>
          const healthHid = window.HealthHid;
          const handleConnectedDevice = (e) => console.log(`Device connected: ${healthHid.getDeviceHumanName(e.device)}`);
          const handleDisconnectedDevice = (e) => {
            console.log(`Device disconnected: ${healthHid.getDeviceHumanName(e.device)}`);
            healthHid.device = null;
          };

          navigator.hid.addEventListener("connect", handleConnectedDevice);
          navigator.hid.addEventListener("disconnect", handleDisconnectedDevice);
        </script>
    </body>
</html>
