<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#fafafa">
        <title>Designated HID Test Site</title>
        <script>
          let device = undefined;

          const getInputData = () => document.getElementById("input").value;
          const setOutputData = (data) => document.getElementById("output").value = data;

          const getId = async () => {
            await window.WebHid.bpm.cmd.getUserId(device, );
          };
          const setId = async () => {
            const id = getInputData();
            await window.WebHid.bpm.cmd.setUserId(device, id);
          };
          const getData = async () => {
            await window.WebHid.bpm.cmd.getData(device, );
          };
        </script>
    </head>
    <body>
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h2>Designated HID Test Site</h2>
        <div>
            <button onclick="window.WebHid.Device.requestDevice().then(dev => device = dev);">
                Select Device
            </button>
            <button onclick="device.closeDevice().then(() => device = undefined);">
                Close Device
            </button>
        </div>
        </div>
        <hr />
        <div style="display: flex; flex-direction: column; margin-bottom: 0.5rem;">
            <div>Input:</div>
            <textarea id="input" style="resize: none; height: 50px"></textarea>
        </div>
        <div style="margin-bottom: 0.5rem;">
            <button onclick="getId()">
                Get ID
            </button>
            <button onclick="setId()">
                Set ID
            </button>
            <button onclick="getData()">
                Get Data
            </button>
        </div>
        <div style="display: flex; flex-direction: column;">
            <div>Output:</div>
            <textarea id="output" disabled style="resize: none; height: 150px"></textarea>
        </div>

        <script type="module">
          const webHid = window.WebHid;
          const handleConnectedDevice = (e) => console.log(`Device connected: ${webHid.getDeviceHumanName(e.device)}`);
          const handleDisconnectedDevice = (e) => {
            console.log(`Device disconnected: ${webHid.getDeviceHumanName(e.device)}`);
            webHid.device = null;
          };

          navigator.hid.addEventListener("connect", handleConnectedDevice);
          navigator.hid.addEventListener("disconnect", handleDisconnectedDevice);

          webHid.bpm.setOutputHandler((data) => {
            setOutputData(data);
          });
        </script>
    </body>
</html>
